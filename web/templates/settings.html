{% extends "base.html" %}
{% block content %}

<style>
  .page-title { font-size:20px; font-weight:950; margin:0 0 6px; }
  .page-sub { color:#64748b; font-size:13px; margin:0 0 16px; line-height:1.45; }

  .grid { display:grid; grid-template-columns: 1fr 1fr; gap:18px; align-items:start; }
  @media (max-width: 980px){ .grid { grid-template-columns: 1fr; } }

  .box{
    border:1px solid #e5e7eb; border-radius:16px; padding:16px; background:#fff;
    box-shadow: 0 10px 24px rgba(0,0,0,0.04);
  }

  label{ display:grid; gap:6px; margin-top:12px; font-weight:900; color:#111827; }
  input, select{
    padding:12px 12px;
    border-radius:14px;
    border:1px solid #d1d5db;
    outline:none;
    width:100%;
    background:#fff;
    font-size:14px;
  }
  input:focus, select:focus{ border-color:#94a3b8; box-shadow: 0 0 0 3px rgba(148,163,184,0.25); }

  .muted{ color:#64748b; font-size:12px; line-height:1.45; }
  .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

  .btn{
    border:1px solid #d1d5db; background:#fff; padding:10px 12px; border-radius:14px;
    cursor:pointer; text-decoration:none; display:inline-flex; gap:8px; align-items:center;
    font-weight:900;
  }
  .btn-primary{ border-color:#111827; background:#111827; color:#fff; }
  .btn-soft{ background:#f8fafc; }
  .btn-danger{ border-color:#9f1239; background:#9f1239; color:#fff; }

  .badge{
    display:inline-flex; align-items:center; gap:6px;
    padding:4px 10px; border-radius:999px; font-size:12px; font-weight:950;
    border:1px solid #e5e7eb; background:#f8fafc; color:#0f172a;
  }
  .ok{ border-color:#86efac; background:#f0fdf4; color:#14532d; }
  .warn{ border-color:#fde68a; background:#fffbeb; color:#7c2d12; }

  hr{ border:none; border-top:1px solid #e5e7eb; margin:16px 0; }

  .kv{ display:grid; gap:6px; margin-top:10px; }
  .kv .k{ font-weight:900; font-size:12px; color:#111827; }
  .kv .v{ font-size:13px; color:#0f172a; word-break:break-word; }

  .note{
    border:1px solid #e2e8f0;
    background:#f8fafc;
    padding:12px;
    border-radius:14px;
    margin-top:12px;
  }
  code{ background:#eef2ff; padding:2px 6px; border-radius:8px; }
</style>

<div>
  <div class="page-title">‚öôÔ∏è Settings</div>
  <p class="page-sub">
    Control sending limits and defaults. These settings affect both manual sends and scheduler runs.
  </p>
</div>

{% set connected = (gmail_connected if gmail_connected is defined else false) %}
{% set gemail = (gmail_email if gmail_email is defined else "") %}

<div class="grid">
  <!-- Preferences -->
  <div class="box">
    <div style="font-weight:950; font-size:16px;">Preferences</div>
    <div class="muted" style="margin-top:6px;">
      Keep limits reasonable so you don‚Äôt accidentally blast people if you schedule wrong.
    </div>

    <form method="POST" style="margin-top:10px;">
      {{ csrf_token() if csrf_token is defined }}

      <label title="Max number of follow-ups your account can send per day">
        Daily send limit
        <span class="muted">Hard cap per day (prevents accidental mass sends).</span>
      </label>
      <input type="number" name="daily_limit" value="{{ daily_limit }}" min="1" max="100" required>

      <label title="Used as a fallback for formatting / defaults">
        Default country
        <span class="muted">Used for defaults like formatting and future expansions.</span>
      </label>
      <select name="default_country">
        {% for c in ["US","NG","GB","CA","AU"] %}
          <option value="{{ c }}" {% if default_country == c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>

      <div class="row" style="margin-top:14px;">
        <button class="btn btn-primary" type="submit" title="Save your settings">üíæ Save settings</button>
        <a class="btn btn-soft" href="{{ url_for('dashboard') }}" title="Back to dashboard">‚Üê Back</a>
      </div>

      <div class="muted" style="margin-top:10px;">
        Tip: When testing, set daily limit to 5 so mistakes don‚Äôt hurt.
      </div>
    </form>
  </div>

  <!-- Gmail -->
  <div class="box">
    <div style="font-weight:950; font-size:16px;">Gmail Connection</div>
    <div class="muted" style="margin-top:6px;">
      Scheduler needs Gmail connected to send emails from your account.
    </div>

    <hr>

    {% if not connected %}
      <div class="badge warn">‚ö†Ô∏è Not connected</div>

      <div class="muted" style="margin-top:10px;">
        Connect Gmail so scheduled follow-ups can send automatically. No Gmail = nothing sends.
      </div>

      <div class="row" style="margin-top:12px;">
        <a href="{{ url_for('gmail_connect') }}" class="btn btn-primary" title="Connect your Gmail account">
          üîó Connect Gmail
        </a>
      </div>

      <div class="note">
        <div style="font-weight:950; font-size:13px;">Heads up</div>
        <div class="muted" style="margin-top:6px;">
          You granted <b>gmail.send</b>, so the app can send emails ‚Äî it can‚Äôt read your inbox.
          (Auto-reply checking would require <code>gmail.readonly</code> later.)
        </div>
      </div>
    {% else %}
      <div class="badge ok">‚úÖ Gmail connected</div>

      {% if gemail %}
        <div class="kv">
          <div class="k">Signed-in app email</div>
          <div class="v">{{ gemail }}</div>
        </div>
      {% endif %}

      <div class="muted" style="margin-top:10px;">
        Scheduled sends can run as normal.
      </div>

      <div class="row" style="margin-top:12px;">
        <a class="btn btn-soft" href="{{ url_for('gmail_connect') }}" title="Reconnect if access was revoked">
          üîÅ Reconnect
        </a>

        <form method="POST" action="{{ url_for('gmail_disconnect') }}" style="display:inline;">
          {{ csrf_token() if csrf_token is defined }}
          <button class="btn btn-danger" type="submit"
                  onclick="return confirm('Disconnect Gmail? Scheduled sends will stop until you reconnect.')"
                  title="Disconnect Gmail from this app">
            üß® Remove Gmail
          </button>
        </form>
      </div>

      <div class="note">
        <div style="font-weight:950; font-size:13px;">What ‚ÄúRemove Gmail‚Äù does</div>
        <div class="muted" style="margin-top:6px;">
          It disconnects Gmail from <b>this app</b>. Your Google account stays fine.
          After disconnecting, scheduled emails won‚Äôt send until you connect again.
        </div>
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}
